<app-navbar [isHidden]="true"></app-navbar>
<app-jumbotron [Heading]="'user.main_heading.shopx_cart'"></app-jumbotron>
<!-- <div class="container mb-4">
    <div class="row">
      <div class="col-12">
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col"></th>
                <th scope="col">Product</th>
                <th scope="col" class="text-center">Quantity</th>
                <th scope="col" class="text-right">Price</th>
                <th scope="col" class="text-right">Action</th>
                <th scope="col" class="text-center">
                  <button
                    (click)="emptycart()"
                    mat-raised-button
                    color="accent"
                  >
                    Empty The Cart
                  </button>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let cartitem of cartitems">
                <td><img src="{{ cartitem.image }}" /></td>
                <td>{{ cartitem.name }}</td>
                <td>
                  <input autocomplete="off"
                    #qty
                    class="form-control"
                    type="number"
                    value="{{ cartitem.quantity }}"
                    min="1"
                    max="{{ cartitem.productqty }}"
                  />
                </td>
                <td class="text-right">{{ cartitem.price }} ₹</td>
                <td class="text-right">
                  <button
                    mat-raised-button
                    color="primary"
                    (click)="updateCart(qty.value, cartitem)"
                  >
                    <mat-icon>refresh</mat-icon>
                  </button>
                </td>
                <td class="text-center">
                  <button
                    mat-raised-button
                    color="warn"
                    (click)="removeFromCart(cartitem)"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </tr>
              <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>Sub-Total</td>
                <td class="text-right">{{ totalprice }} ₹</td>
              </tr>
              <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>Shipping</td>
                <td class="text-right">{{ shipping }} ₹</td>
              </tr>
              <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td><strong>Total</strong></td>
                <td class="text-right">
                  <strong>{{ totalprice + shipping }} ₹</strong>
                </td>
              </tr>
              <tr></tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="col mb-2">
        <div class="row">
          <div class="col-sm-12  col-md-6">
            <button
              [routerLink]="['/homepage']"
              routerLinkActive="router-link-active"
              class="btn btn-lg btn-block btn-primary"
            >
              Continue Shopping
            </button>
          </div>
          <div class="col-sm-12 col-md-6 text-right">
            <button class="btn btn-lg btn-block btn-success text-uppercase">
              Checkout
            </button>
          </div>
        </div>
      </div>
    </div>
  </div> -->
<app-spinner
  *ngIf="dimmed"
  style="position: absolute;z-index: 999;left: 50%; top: 50%;"
  [loading]="dataLoading"
></app-spinner>
<div class="table-wrapper" [ngClass]="{dimmed: dimmed}">
  <mat-table
    [ngStyle]="{height: height+'px'}"
    [dataSource]="dataSource"
    matSort
    class="box-elevation-z8"
  >
    <ng-container matColumnDef="image">
      <mat-header-cell *matHeaderCellDef mat-sort-header>
        {{"user.product.image" | translate}}
      </mat-header-cell>
      <mat-cell *matCellDef="let element">
        <img class="product-image" src="{{ element.image[0].imageurl }}" />
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="name">
      <mat-header-cell *matHeaderCellDef mat-sort-header>
        {{"user.product.name" | translate}}
      </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.name }} </mat-cell>
    </ng-container>

    <ng-container matColumnDef="quantity">
      <mat-header-cell *matHeaderCellDef mat-sort-header>
        {{"user.product.quantity" | translate}}
      </mat-header-cell>
      <mat-cell *matCellDef="let element">
        <div class="input-quantity">
          <mat-form-field class="search-field" appearance="outline">
            <input
              autocomplete="off"
              (keypress)="eventHandler($event)"
              matInput
              #qty
              [formControl]="quantityformcontrol"
              type="number"
              min="1"
              max="{{ element.productqty }}"
              value="{{ element.quantity }}"
            />
          </mat-form-field>
        </div>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="price">
      <mat-header-cell *matHeaderCellDef mat-sort-header>
        {{"user.product.price" | translate}}
      </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.price }} </mat-cell>
    </ng-container>

    <ng-container matColumnDef="action">
      <mat-header-cell *matHeaderCellDef mat-sort-header>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        {{"user.product.action" | translate}}
      </mat-header-cell>
      <mat-cell *matCellDef="let element">
        <button
          mat-raised-button
          color="accent"
          matTooltip="{{'tooltip.update' | translate}}"
          matTooltipPosition="left"
          [matTooltipShowDelay]="500"
          (click)="updateCart(quantityformcontrol.value, element)"
        >
          <mat-icon>refresh</mat-icon>
        </button>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <button
          mat-raised-button
          color="primary"
          matTooltip="quickview"
          matTooltipPosition="right"
          [matTooltipShowDelay]="500"
          (click)="quickview(element)"
        >
          <mat-icon>remove_red_eye</mat-icon>
        </button>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="delete">
      <mat-header-cell *matHeaderCellDef>
        <button
          mat-raised-button
          class="empty-btn"
          color="accent"
          matTooltip="{{'tooltip.empty_cart' | translate}}"
          matTooltipPosition="above"
          [matTooltipShowDelay]="500"
          (click)="emptycart()"
        >
          {{"user.product.empty_the_cart" | translate}}
        </button>
      </mat-header-cell>
      <mat-cell *matCellDef="let element">
        <button
          mat-raised-button
          color="warn"
          class="delete-btn"
          matTooltip="{{'tooltip.delete_item' | translate}}"
          matTooltipPosition="right"
          [matTooltipShowDelay]="500"
          (click)="removeFromCart(element)"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns ;sticky: true"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
  </mat-table>
  <br />
</div>
<mat-card class="total-card">
  {{"user.cart.total_price" | translate}} : {{getTotalCost() | currency}}
</mat-card>
<br /><br /><br />
<mat-toolbar color="primary" class="c-bottom-action-bar u-text-right table-bottom">
  <button mat-raised-button style="width: 20%;" [routerLink]="['/home']">
    {{"user.cart.continue_shopping" | translate}}
  </button>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <button mat-raised-button style="width: 20%;" [routerLink]="['/checkout/#']" color="warn">
    {{"user.cart.checkout" | translate}}
  </button>
</mat-toolbar>
